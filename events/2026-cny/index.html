<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>新春好運三響砲 - 抽獎活動</title>
<style>
  /* --- 基礎設定 --- */
  body {
    margin: 0; padding: 0;
    font-family: "Microsoft JhengHei", Arial, sans-serif;
    overflow: hidden;
    background-color: #000;
  }

  /* --- 1. 主場景 --- */
  .scene-container {
    position: relative;
    width: 100vw;
    height: 100vh;
    background-image: url('tree_bg.jpg'); /* 背景圖 */
    background-size: cover;
    background-position: center bottom;
    z-index: 1;
  }

  /* 遮罩層 (讓背景稍微暗一點，凸顯紅繩) */
  .overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.2); 
    pointer-events: none;
  }

  /* --- 2. 中國結樣式 (位置下移修正版) --- */
  .knot {
    position: absolute;
    width: 30vw;         /* 巨大化尺寸 */
    max-width: 280px;
    height: auto;
    
    /* [關鍵修正]：往下移動到樹葉下方 */
    /* 原本是 -5%，現在改成 15%，空出上方給樹葉 */
    top: 15%;            
    
    filter: drop-shadow(0px 8px 15px rgba(0,0,0,0.7)); 
    cursor: pointer;
    transform-origin: top center;
    animation: swing 3s ease-in-out infinite alternate;
    transition: transform 0.5s cubic-bezier(0.25, 1.5, 0.5, 1);
    z-index: 10;
  }

  @keyframes swing {
    0% { transform: rotate(-1.5deg); } 
    100% { transform: rotate(1.5deg); }
  }

  .knot.pulled {
    /* 拉動時往下掉更多，並放大 */
    /* 因為初始位置變低了，這裡的位移量稍微減少一點，避免掉出螢幕太多 */
    transform: translateY(20vh) scale(1.05) !important; 
  }

  /* --- 3. 標題與提示 --- */
  .title-area {
    position: absolute;
    bottom: 8%;
    width: 100%;
    text-align: center;
    color: #fff;
    pointer-events: none;
    z-index: 5;
  }
  .title-area h1 { 
    margin: 0; 
    font-size: 2rem; 
    color: #FFD700; 
    text-shadow: 0 0 10px #d32f2f;
  }
  .title-area p { margin: 10px 0 0; font-size: 1.1rem; opacity: 0.9; font-weight: bold; }

  /* --- 4. 彈窗樣式 --- */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 999;
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #fff;
    width: 80%; max-width: 320px;
    padding: 30px 20px;
    border-radius: 20px;
    text-align: center;
    border: 5px solid #d32f2f;
    animation: popIn 0.3s ease-out;
  }
  .prize-title { font-size: 1.2rem; color: #555; margin-bottom: 10px; }
  .prize-name { font-size: 2rem; color: #d32f2f; font-weight: bold; margin-bottom: 20px; }
  .btn-confirm {
    background: linear-gradient(to right, #d32f2f, #b71c1c);
    color: white; border: none;
    padding: 12px 40px; border-radius: 50px; font-size: 1.1rem;
    cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  }
  @keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
</style>
</head>
<body>

<div class="scene-container" id="scene">
  <div class="overlay"></div>
  
  <div class="title-area">
    <h1>新春好運 • 三響砲</h1>
    <p>請選擇一條幸運大紅繩向下拉</p>
  </div>
</div>

<div class="modal-overlay" id="resultModal">
  <div class="modal-content">
    <div class="prize-title">恭喜獲得</div>
    <div class="prize-name" id="prizeText">...</div>
    <button class="btn-confirm" onclick="closeModal()">收下好運</button>
  </div>
</div>

<script>
  const scene = document.getElementById('scene');
  const modal = document.getElementById('resultModal');
  const prizeText = document.getElementById('prizeText');
  
  const totalKnots = 3;
  const demoPrizes = ["9折維修券", "免費鋼化膜", "快充傳輸線", "現金折抵$100", "銘謝惠顧"];

  function initGame() {
    for (let i = 0; i < totalKnots; i++) {
      createKnot(i);
    }
  }

  function createKnot(index) {
    const knotImg = document.createElement('img');
    knotImg.src = 'knot.png'; 
    knotImg.className = 'knot';
    
    // --- 3分區精準定位法 ---
    const sectionWidth = 100 / totalKnots; 
    const centerOfSection = (index * sectionWidth) + (sectionWidth / 2); 
    
    // 圖片寬度的一半 (30vw / 2 = 15)
    const finalLeft = centerOfSection - 15; 

    knotImg.style.left = finalLeft + '%';
    
    // 隨機動畫延遲
    knotImg.style.animationDelay = -(Math.random() * 2) + 's';

    knotImg.addEventListener('click', function() {
      playPullAnimation(knotImg);
    });

    scene.appendChild(knotImg);
  }

  function playPullAnimation(element) {
    element.classList.add('pulled');
    element.style.pointerEvents = 'none';

    setTimeout(() => {
      const randomPrize = demoPrizes[Math.floor(Math.random() * demoPrizes.length)];
      showResult(randomPrize);
      
      setTimeout(() => {
        element.classList.remove('pulled');
        element.style.pointerEvents = 'auto'; 
      }, 500);
    }, 600);
  }

  function showResult(prize) {
    prizeText.innerText = prize;
    modal.style.display = 'flex';
  }

  function closeModal() {
    modal.style.display = 'none';
  }

  initGame();
</script>

</body>
</html>
