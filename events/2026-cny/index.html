<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>新春五福臨門 - 抽獎活動</title>
<style>
  /* --- 基礎設定 --- */
  body {
    margin: 0; padding: 0;
    font-family: "Microsoft JhengHei", Arial, sans-serif;
    overflow: hidden;
    background-color: #000;
  }

  /* --- 1. 主場景 --- */
  .scene-container {
    position: relative;
    width: 100vw;
    height: 100vh;
    background-image: url('tree_bg.jpg'); /* 背景圖 */
    background-size: cover;
    background-position: center bottom;
    z-index: 1;
  }

  /* 遮罩層 (讓背景稍微暗一點，凸顯紅繩) */
  .overlay {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.2); 
    pointer-events: none;
  }

  /* --- 2. 中國結樣式 (修正版) --- */
  .knot {
    position: absolute;
    /* 修正點 1: 尺寸加大 */
    width: 18vw;         /* 佔據螢幕寬度的 18%，手機上看很大 */
    max-width: 130px;    /* 電腦版限制最大寬度，避免過大 */
    height: auto;
    
    /* 修正點 2: 統一從最上方垂掛 */
    top: -5%;            /* 稍微往上提一點，隱藏圖片切邊，製造無限延伸感 */
    
    filter: drop-shadow(0px 5px 10px rgba(0,0,0,0.6));
    cursor: pointer;
    transform-origin: top center; /* 擺動支點在頂部 */
    animation: swing 3s ease-in-out infinite alternate;
    transition: transform 0.5s cubic-bezier(0.25, 1.5, 0.5, 1);
    z-index: 10;
  }

  @keyframes swing {
    0% { transform: rotate(-2deg); }
    100% { transform: rotate(2deg); }
  }

  .knot.pulled {
    /* 拉動時往下掉更多，並放大 */
    transform: translateY(20vh) scale(1.1) !important; 
  }

  /* --- 3. 標題與提示 --- */
  .title-area {
    position: absolute;
    bottom: 8%;
    width: 100%;
    text-align: center;
    color: #fff;
    pointer-events: none;
    z-index: 5;
  }
  .title-area h1 { 
    margin: 0; 
    font-size: 2rem; 
    color: #FFD700; 
    text-shadow: 0 0 10px #d32f2f;
  }
  .title-area p { margin: 10px 0 0; font-size: 1rem; opacity: 0.9; }

  /* --- 4. 彈窗樣式 --- */
  .modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 999;
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #fff;
    width: 80%; max-width: 320px;
    padding: 30px 20px;
    border-radius: 20px;
    text-align: center;
    border: 5px solid #d32f2f;
    animation: popIn 0.3s ease-out;
  }
  .prize-title { font-size: 1.2rem; color: #555; margin-bottom: 10px; }
  .prize-name { font-size: 2rem; color: #d32f2f; font-weight: bold; margin-bottom: 20px; }
  .btn-confirm {
    background: linear-gradient(to right, #d32f2f, #b71c1c);
    color: white; border: none;
    padding: 12px 40px; border-radius: 50px; font-size: 1.1rem;
    cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2);
  }
  @keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
</style>
</head>
<body>

<div class="scene-container" id="scene">
  <div class="overlay"></div>
  
  <div class="title-area">
    <h1>五福臨門 • 新春抽好禮</h1>
    <p>請選擇一條幸運紅繩向下拉</p>
  </div>
</div>

<div class="modal-overlay" id="resultModal">
  <div class="modal-content">
    <div class="prize-title">恭喜獲得</div>
    <div class="prize-name" id="prizeText">...</div>
    <button class="btn-confirm" onclick="closeModal()">收下好運</button>
  </div>
</div>

<script>
  const scene = document.getElementById('scene');
  const modal = document.getElementById('resultModal');
  const prizeText = document.getElementById('prizeText');
  
  // 修正點 2: 設定數量為 5
  const totalKnots = 5;
  const demoPrizes = ["9折維修券", "免費鋼化膜", "快充傳輸線", "現金折抵$100", "銘謝惠顧"];

  function initGame() {
    // 取得螢幕寬度
    const screenWidth = window.innerWidth;
    
    for (let i = 0; i < totalKnots; i++) {
      createKnot(i);
    }
  }

  function createKnot(index) {
    const knotImg = document.createElement('img');
    knotImg.src = 'knot.png'; 
    knotImg.className = 'knot';
    
    // --- 修正點 3: 絕對不重疊的分區定位法 ---
    // 將螢幕分成 5 等份 (每份 20%)
    // 每個結繩放在該區塊的中間，再加上一點點隨機偏移(-2% ~ +2%)讓它看起來自然
    
    const sectionWidth = 100 / totalKnots; // 20
    const centerOfSection = (index * sectionWidth) + (sectionWidth / 2); // 10, 30, 50, 70, 90
    
    // 為了視覺平衡，我們要減去圖片本身寬度的一半 (假設圖片約寬 18vw -> 9vw)
    // 加上一點點隨機偏移 (-2% 到 2%)
    const randomOffset = (Math.random() * 4) - 2; 
    
    const finalLeft = centerOfSection - 9 + randomOffset; 

    knotImg.style.left = finalLeft + '%';
    
    // 隨機動畫延遲
    knotImg.style.animationDelay = -(Math.random() * 2) + 's';

    // 綁定點擊
    knotImg.addEventListener('click', function() {
      playPullAnimation(knotImg);
    });

    scene.appendChild(knotImg);
  }

  function playPullAnimation(element) {
    element.classList.add('pulled');
    element.style.pointerEvents = 'none';

    setTimeout(() => {
      const randomPrize = demoPrizes[Math.floor(Math.random() * demoPrizes.length)];
      showResult(randomPrize);
      
      // 復原
      setTimeout(() => {
        element.classList.remove('pulled');
        element.style.pointerEvents = 'auto'; 
      }, 500);
    }, 600);
  }

  function showResult(prize) {
    prizeText.innerText = prize;
    modal.style.display = 'flex';
  }

  function closeModal() {
    modal.style.display = 'none';
  }

  initGame();
</script>

</body>
</html>
